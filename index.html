<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下班功課月曆</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide 圖示的簡化版本
        const Check = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
        const BookOpen = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const Cpu = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>;
        const Binary = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>;
        const Book = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const Calendar = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>;
        const ChevronLeft = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const ChevronRight = ({className}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;

        function StudyCalendar() {
          const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
          const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
          const [records, setRecords] = useState(() => {
            const saved = localStorage.getItem('studyRecords');
            return saved ? JSON.parse(saved) : {};
          });

          useEffect(() => {
            localStorage.setItem('studyRecords', JSON.stringify(records));
          }, [records]);

          // 【修改】更新課表，加入 C 語言
          const subjects = {
            1: { name: '英文', color: 'bg-blue-500', icon: BookOpen },
            2: { name: '電子學', color: 'bg-purple-500', icon: Cpu },
            3: { name: '數位邏輯', color: 'bg-green-500', icon: Binary },
            4: { name: 'C語言', color: 'bg-pink-500', icon: Binary },
            5: { name: '課外讀物', color: 'bg-indigo-500', icon: Book },
          };

          const getDaysInMonth = () => {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const days = [];
            for (let i = 0; i < startingDayOfWeek; i++) {
              days.push(null);
            }
            for (let i = 1; i <= daysInMonth; i++) {
              days.push(i);
            }
            return days;
          };

          const getDayOfWeek = (day) => {
            if (!day) return null;
            const date = new Date(currentYear, currentMonth, day);
            return date.getDay();
          };

          const getSubjectForDay = (day) => {
            if (!day) return null;
            const dayOfWeek = getDayOfWeek(day);
            if (dayOfWeek === null || dayOfWeek === 0 || dayOfWeek === 6) return null;
            return subjects[dayOfWeek];
          };

          const updateHours = (day, value) => {
            const hours = parseFloat(value) || 0;
            const key = `${currentYear}-${currentMonth}-${day}`;
            setRecords(prev => ({
              ...prev,
              [key]: {
                ...prev[key],
                hours: hours,
                completed: hours > 0,
                notes: prev[key]?.notes || ''
              }
            }));
          };
          
          const updateNotes = (day, notes) => {
            const key = `${currentYear}-${currentMonth}-${day}`;
            setRecords(prev => ({
              ...prev,
              [key]: { ...prev[key], notes, completed: prev[key]?.completed || false, hours: prev[key]?.hours || 0 }
            }));
          };

          const getRecord = (day) => {
            const key = `${currentYear}-${currentMonth}-${day}`;
            return records[key] || { completed: false, notes: '', hours: 0 };
          };

          const changeMonth = (offset) => {
            let newMonth = currentMonth + offset;
            let newYear = currentYear;
            
            if (newMonth > 11) {
              newMonth = 0;
              newYear++;
            } else if (newMonth < 0) {
              newMonth = 11;
              newYear--;
            }
            
            setCurrentMonth(newMonth);
            setCurrentYear(newYear);
          };

          const goToToday = () => {
            const today = new Date();
            setCurrentYear(today.getFullYear());
            setCurrentMonth(today.getMonth());
          };

          const calculateStats = () => {
            const days = getDaysInMonth().filter(d => d !== null);
            const monthRecords = days.map(day => ({ day, record: getRecord(day) }));

            const totalHours = monthRecords.reduce((sum, { record }) => sum + (record.hours || 0), 0);

            const weekStats = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
            monthRecords.forEach(({ day, record }) => {
                if (record.hours > 0) {
                    const dayOfWeek = getDayOfWeek(day);
                    if (weekStats[dayOfWeek] !== undefined) {
                        weekStats[dayOfWeek] += record.hours;
                    }
                }
            });

            const allTimeTotal = Object.values(records).reduce((sum, r) => sum + (r.hours || 0), 0);
            
            const weekdayCount = days.filter(day => {
                const dayOfWeek = getDayOfWeek(day);
                return dayOfWeek >= 1 && dayOfWeek <= 5;
            }).length;
            
            const completedDaysCount = monthRecords.filter(({ record }) => record.completed).length;

            return { totalHours, weekStats, allTimeTotal, weekdayCount, completedDaysCount };
          };

          const days = getDaysInMonth();
          const stats = calculateStats();
          const monthName = new Date(currentYear, currentMonth).toLocaleDateString('zh-TW', { year: 'numeric', month: 'long' });
          const today = new Date();
          const isCurrentMonth = currentMonth === today.getMonth() && currentYear === today.getFullYear();

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
              <div className="max-w-7xl mx-auto">
                <div className="text-center mb-8">
                  <div className="flex items-center justify-center gap-3 mb-4">
                    <Calendar className="w-10 h-10 text-purple-300" />
                    <h1 className="text-4xl font-bold text-white">下班功課月曆</h1>
                  </div>
                  
                  <div className="flex items-center justify-center gap-4 mb-2">
                    <button
                      onClick={() => changeMonth(-1)}
                      className="p-2 rounded-lg bg-white/10 hover:bg-white/20 border border-white/20 transition-all"
                    >
                      <ChevronLeft className="w-6 h-6 text-white" />
                    </button>
                    
                    <div className="min-w-[200px]">
                      <div className="text-2xl font-bold text-white">{monthName}</div>
                    </div>
                    
                    <button
                      onClick={() => changeMonth(1)}
                      className="p-2 rounded-lg bg-white/10 hover:bg-white/20 border border-white/20 transition-all"
                    >
                      <ChevronRight className="w-6 h-6 text-white" />
                    </button>
                  </div>

                  {!isCurrentMonth && (
                    <button
                      onClick={goToToday}
                      className="px-4 py-2 rounded-lg bg-purple-500 hover:bg-purple-600 text-white font-medium transition-all"
                    >
                      回到本月
                    </button>
                  )}
                  
                  <p className="text-lg text-purple-200 mt-2">每天 22:00 - 23:00</p>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 mb-8">
                  <div className="grid grid-cols-7 gap-2 mb-4">
                    {['日', '一', '二', '三', '四', '五', '六'].map(day => (
                      <div key={day} className="text-center text-purple-200 font-bold text-lg py-2">
                        {day}
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-7 gap-2">
                    {days.map((day, index) => {
                      if (!day) {
                        return <div key={`empty-${index}`} className="aspect-square" />;
                      }

                      const dayOfWeek = getDayOfWeek(day);
                      const subject = getSubjectForDay(day);
                      const record = getRecord(day);
                      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                      const isToday = isCurrentMonth && day === today.getDate();

                      return (
                        <div
                          key={`${currentYear}-${currentMonth}-${day}`}
                          className={`aspect-square rounded-lg p-2 ${
                            isWeekend 
                              ? 'bg-white/5 border border-white/10' 
                              : 'bg-white/10 border border-white/20 hover:bg-white/20 transition-all'
                          } ${isToday ? 'ring-2 ring-yellow-400' : ''}`}
                        >
                          <div className="h-full flex flex-col">
                            <div className="flex items-start justify-between mb-1">
                              <span className={`font-semibold ${isToday ? 'text-yellow-400' : 'text-white'}`}>
                                {day}
                              </span>
                              {subject && (
                                <div className="relative w-12">
                                  <input
                                    type="number"
                                    step="0.5"
                                    min="0"
                                    placeholder="時數"
                                    value={record.hours > 0 ? record.hours : ''}
                                    onChange={(e) => updateHours(day, e.target.value)}
                                    className="w-full bg-white/20 text-white text-xs text-center rounded pl-1 pr-1 py-0.5 border border-transparent focus:outline-none focus:border-purple-400 placeholder-white/40"
                                  />
                                  {record.completed && <Check className="w-3 h-3 text-green-400 absolute top-1/2 right-1 -translate-y-1/2 pointer-events-none" />}
                                </div>
                              )}
                            </div>
                            
                            {subject && (
                              <div className="flex-1 flex flex-col">
                                <div className={`${subject.color} text-white text-xs px-2 py-1 rounded mb-1 text-center`}>
                                  {subject.name}
                                </div>
                                <input
                                  type="text"
                                  placeholder="記錄內容..."
                                  value={record.notes}
                                  onChange={(e) => updateNotes(day, e.target.value)}
                                  className="w-full bg-white/10 text-white text-xs px-1 py-1 rounded border border-white/20 placeholder-white/40 focus:outline-none focus:border-purple-400"
                                />
                              </div>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                    <h2 className="text-2xl font-bold text-white mb-4">📊 本月統計</h2>
                    <div className="space-y-3">
                      {Object.entries(subjects).map(([day, subject]) => {
                        const Icon = subject.icon;
                        const hours = stats.weekStats[day];
                        return (
                          <div key={day} className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                              <div className={`${subject.color} p-2 rounded-lg`}>
                                <Icon className="w-5 h-5 text-white" />
                              </div>
                              <span className="text-white font-medium">{subject.name}</span>
                            </div>
                            <div className="text-right">
                              <span className="text-2xl font-bold text-white">{parseFloat(hours.toFixed(2))}</span>
                              <span className="text-purple-200 text-sm ml-1">小時</span>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                    <h2 className="text-2xl font-bold text-white mb-4">🎯 累積統計</h2>
                    <div className="space-y-6">
                      <div className="text-center p-6 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl">
                        <div className="text-5xl font-bold text-white mb-2">{parseFloat(stats.totalHours.toFixed(2))}</div>
                        <div className="text-purple-200">本月累積時數</div>
                      </div>
                      
                      <div className="grid grid-cols-2 gap-4">
                        <div className="text-center p-4 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-lg">
                          <div className="text-3xl font-bold text-white mb-1">
                            {parseFloat(stats.allTimeTotal.toFixed(2))}
                          </div>
                          <div className="text-purple-200 text-sm">總累積時數</div>
                        </div>
                        <div className="text-center p-4 bg-white/5 rounded-lg">
                          <div className="text-3xl font-bold text-white mb-1">
                            {stats.weekdayCount > 0 ? Math.round((stats.completedDaysCount / stats.weekdayCount) * 100) : 0}%
                          </div>
                          <div className="text-purple-200 text-sm">本月完成率</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-6 text-center">
                  <p className="text-lg text-purple-300 italic">
                    ✨ 每一個打勾都是進步的證明，堅持下去！
                  </p>
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<StudyCalendar />, document.getElementById('root'));
    </script>
</body>
</html>